<!DOCTYPE HTML>
<html>
<head>
  <meta charset="UTF-8">
  <title>Loading&hellip;</title>
  <link rel="stylesheet" href="styles/main.css">
  <script src="generated/main.js"></script>

  <style>
      @import url('https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,400;0,500;0,700;1,400&family=Space+Mono&display=swap');
  </style>

  <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.1/build/pure-min.css" integrity="sha384-QkSsJi6SGgWv5LAx1TdvIDRf8TW5Ui4NVKqDDlK1wY2eKioo7wvYIJvGWFQSFE4U" crossorigin="anonymous">
  <link rel="stylesheet" href="lib/DrawerJS/assets/font-awesome.min.css">
  <link rel="stylesheet" href="lib/DrawerJS/dist/drawerJs.min.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
  <script type='text/javascript' src='lib/PortFunnel.js'></script>
  <script type='text/javascript' src='lib/PortFunnel/WebSocket.js'></script>
  <script type='text/javascript' src='lib/PortFunnel/LocalStorage.js'></script>

  <script type="text/javascript" src='lib/DrawerJS/lib/jquery-3.4.1.min.js'></script>
  <script type="text/javascript" src='lib/DrawerJS/dist/drawerJs.standalone.min.js'></script>
  <script type="text/javascript" src='lib/BrushSizeSimple.js'></script>
  <script>

var drawerPlugins = [
    'Pencil',
    'Eraser',
    'Line',
    'ArrowOneSide',
    'ArrowTwoSide',
    'Rectangle',
    'Circle',
    'Color',
    'BrushSizeSimple',
    // 'Resize',
    // 'ShapeContextMenu'
];

var app = Elm.Main.init();

// These are the defaults, so you don't need to pass them.  If you
// need to use different port names, you can pass them as the
// 'portNames' property of the second parameter to
// PortFunnel.subscribe() below:
// var portNames = ['cmdPort', 'subPort'];
// PortFunnel.subscribe(app, { portNames: portNames });

PortFunnel.subscribe(app);

(function() {
  var ports = app.ports;

  var error = ports.errorPort;
  if (error) {
    error.subscribe(function(string) {
      console.error(string);
    });
  }

  app.ports.confirmPort.subscribe(function(data) {
    text = data[0];
    id = data[1];

    app.ports.confirmReturnPort.send([window.confirm(text), id])
  });


    customElements.define('drawing-canvas',
        class extends HTMLElement {
            // things required by Custom Elements
            constructor() { super(); }

            static get observedAttributes() { return ['key']; }

            attributeChangedCallback(name, oldValue, newValue) {
                console.log(name, oldValue, newValue);
            }

            connectedCallback() {
                var drawer = new DrawerJs.Drawer(null, {
                    plugins: drawerPlugins,
                    pluginsConfig: {
                        Zoom: {
                            enabled: false
                        }
                    },
                    defaultActivePlugin : { name : 'Pencil', mode : 'lastUsed' },
                    exitOnOutsideClick: false,
                    contentConfig: {
                        saveInHtml: false,
                        saveCanvasData: function(canvasId, canvasData){
                            localStorage.setItem('drawtice.canvas', JSON.stringify(JSON.parse(canvasData)));
                        },
                        loadCanvasData: function(canvasId){
                            return localStorage.getItem('drawtice.canvas');
                        },
                    }
                }, '100%', this.offsetHeight);
                this.innerHTML = drawer.getHtml();
                drawer.onInsert();
                drawer.api.startEditing();
            }
        }
    );

        console.log(app.ports);

    // app.ports.canvasPort.subscribe(function(input) {
    //     var command = input[0];
    //     var data = input[1];
    //     if (data == "create") {
    //     } else if (data == "setkey") {

    //     }
    // });

  // Debugging
//   ports.cmdPort.subscribe(function (string) {
//       console.log(string);
//   })

})();

    </script>
</body>
</html>
